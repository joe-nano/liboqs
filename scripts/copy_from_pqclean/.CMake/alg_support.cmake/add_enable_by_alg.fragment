{% for family in instructions['kems'] %}
option(OQS_ENABLE_KEM_{{ family['name']|upper }} "" ON)
    {%- for scheme in family['schemes'] %}
cmake_dependent_option(OQS_ENABLE_KEM_{{ family['name'] }}_{{ scheme['scheme'] }} "" ON "OQS_ENABLE_KEM_{{ family['name']|upper }}" OFF)
        {%- for impl in scheme['metadata']['implementations'] if impl['name'] != family['default_implementation'] and impl['supported_platforms'] -%}
            {%- for platform in impl['supported_platforms'] if platform['architecture'] == 'x86_64' %}
if(ARCH STREQUAL "x86_64" AND CMAKE_SYSTEM_NAME MATCHES "{{ platform['operating_systems']|join('|') }}")
    cmake_dependent_option(OQS_ENABLE_KEM_{{ family['name'] }}_{{ scheme['scheme'] }}_{{ impl['name']  }} "" ON "{%- for flag in platform['required_flags'] -%} OQS_USE_{{ flag|upper}}_INSTRUCTIONS;{%- endfor -%}OQS_ENABLE_KEM_{{ family['name']|upper }}" OFF)
endif()
            {%- endfor -%}
        {%- endfor -%}
    {%- endfor %}
{% endfor -%}

{% for family in instructions['sigs'] %}
option(OQS_ENABLE_SIG_{{ family['name']|upper }} "" ON)
    {%- for scheme in family['schemes'] %}
cmake_dependent_option(OQS_ENABLE_SIG_{{ family['name'] }}_{{ scheme['scheme'] }} "" ON "OQS_ENABLE_SIG_{{ family['name']|upper }}" OFF)
        {%- for impl in scheme['metadata']['implementations'] if impl['name'] != family['default_implementation'] and impl['supported_platforms'] -%}
            {%- for platform in impl['supported_platforms'] if platform['architecture'] == 'x86_64' %}
if(ARCH STREQUAL "x86_64" AND CMAKE_SYSTEM_NAME MATCHES "{{ platform['operating_systems']|join('|') }}")
    cmake_dependent_option(OQS_ENABLE_SIG_{{ family['name'] }}_{{ scheme['scheme'] }}_{{ impl['name']  }} "" ON "{%- for flag in platform['required_flags'] -%} OQS_USE_{{ flag|upper }}_INSTRUCTIONS;{%- endfor -%}OQS_ENABLE_SIG_{{ family['name']|upper }}" OFF)
endif()
            {%- endfor -%}
        {%- endfor -%}
    {%- endfor %}
{% endfor -%}

